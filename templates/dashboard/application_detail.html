{% extends 'dashboard/base.html' %}

{% block title %}Chi tiết đơn ứng tuyển - Bảng điều khiển{% endblock %}
{% block page_title %}Chi tiết đơn ứng tuyển{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 350px; gap: 24px;">
    <!-- Main Content -->
    <div>
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Thông tin ứng viên</h3>
                <span class="badge badge-{{ application.status|lower }}">
                    {% if application.status == 'Pending' %}Chờ xét duyệt
                    {% elif application.status == 'Reviewed' %}Đã xem
                    {% elif application.status == 'Accepted' %}Đã chấp nhận
                    {% elif application.status == 'Rejected' %}Đã từ chối
                    {% else %}{{ application.status }}{% endif %}
                </span>
            </div>
            <div class="panel-body">
                <div style="display: flex; gap: 24px; margin-bottom: 24px;">
                    <div class="applicant-photo"
                        style="width: 120px; height: 120px; border-radius: 12px; overflow: hidden; flex-shrink: 0;">
                        {% if application.photo %}
                        <img src="{{ application.photo.url }}" alt="{{ application.full_name }}"
                            style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        <div class="photo-placeholder"
                            style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background-color: #f1f5f9; font-size: 48px;">
                            <i class="fa-solid fa-user"></i></div>
                        {% endif %}
                    </div>
                    <div>
                        <h2 style="font-size: 24px; margin-bottom: 8px;">{{ application.full_name|default:application.user.get_full_name|default:application.user.username }}</h2>
                        <div style="color: var(--primary-color); font-size: 16px; margin-bottom: 16px;">
                            Ứng tuyển: <strong>{{ application.job.title }}</strong>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 20px; font-size: 14px; color: var(--text-light);">
                            <span><i class="fa-solid fa-envelope"></i> {{ application.email|default:application.user.email }}</span>
                            <span><i class="fa-solid fa-phone"></i> {{ application.phone|default:"Chưa cung cấp" }}</span>
                            <span><i class="fa-solid fa-calendar"></i> Nộp ngày: {{ application.created_at|date:"d/m/Y" }}</span>
                        </div>
                    </div>
                </div>

                {% if application.cv_file %}
                <div style="margin-bottom: 24px;">
                    <a href="{{ application.cv_file.url }}" class="btn btn-primary" target="_blank" download>
                        <i class="fa-solid fa-file-pdf"></i> Tải CV
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        {% if application.introduction %}
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Giới thiệu bản thân</h3>
            </div>
            <div class="panel-body">
                <p style="line-height: 1.8;">{{ application.introduction|linebreaks }}</p>
            </div>
        </div>
        {% endif %}

        {% if application.cover_letter %}
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Thư xin việc</h3>
            </div>
            <div class="panel-body">
                <p style="line-height: 1.8;">{{ application.cover_letter|linebreaks }}</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div>
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Hành động</h3>
            </div>
            <div class="panel-body">
                <form method="POST" action="{% url 'dashboard:update_application_status' application.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label class="form-label">Cập nhật trạng thái</label>
                        <select name="status" class="form-control">
                            <option value="Pending" {% if application.status == 'Pending' %}selected{% endif %}>Chờ xét duyệt</option>
                            <option value="Reviewed" {% if application.status == 'Reviewed' %}selected{% endif %}>Đã xem</option>
                            <option value="Accepted" {% if application.status == 'Accepted' %}selected{% endif %}>Đã chấp nhận</option>
                            <option value="Rejected" {% if application.status == 'Rejected' %}selected{% endif %}>Đã từ chối</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Cập nhật trạng thái
                    </button>
                </form>

                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border-color);">

                <div style="display: flex; flex-direction: column; gap: 10px;">
                    {% if application.status != 'Accepted' %}
                    <form method="POST" action="{% url 'dashboard:update_application_status' application.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Accepted">
                        <button type="submit" class="btn btn-success" style="width: 100%;">
                            <i class="fa-solid fa-circle-check"></i> Chấp nhận ứng viên
                        </button>
                    </form>
                    {% endif %}

                    {% if application.status != 'Rejected' %}
                    <form method="POST" action="{% url 'dashboard:update_application_status' application.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="Rejected">
                        <button type="submit" class="btn btn-danger" style="width: 100%;">
                            <i class="fa-solid fa-circle-xmark"></i> Từ chối ứng viên
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Job Info -->
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Thông tin việc làm</h3>
            </div>
            <div class="panel-body">
                <p style="font-weight: 600; margin-bottom: 8px;">{{ application.job.title }}</p>
                <p style="font-size: 14px; color: var(--text-light); margin-bottom: 16px;">{{ application.job.location_short }}</p>
                <a href="{% url 'jobs:detail' application.job.id %}" class="btn btn-secondary btn-sm" target="_blank">
                    Xem tin tuyển dụng
                </a>
            </div>
        </div>
    </div>
</div>

<div style="margin-top: 24px;">
    <a href="{% url 'dashboard:all_applications' %}" class="btn btn-secondary">
        ← Quay lại danh sách
    </a>
</div>
{% endblock %}